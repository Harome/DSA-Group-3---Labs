<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binary Tree Visualization</title>
    <link rel="stylesheet" href="https://unpkg.com/vis-network/standalone/umd/vis-network.min.css">
</head>
<body>

<h1>Binary Tree Visualization</h1>

<form id="treeForm" method="post" action="{{ url_for('index_tree') }}">
    {{ form.hidden_tag() }}
    <label for="position">Add to:</label>
    {{ form.position() }}
    <label for="value">Node Value:</label>
    {{ form.value() }}
    {{ form.submit() }}
</form>

<h2>Binary Tree Traversal:</h2>
<p id="treeTraversal">{{ tree_traversal }}</p>

<div id="network"></div>

<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<script>
    function updateTree() {
        var treeData = {{ tree_traversal|tojson|safe }};
        var nodes = [];
        for (var i = 0; i < treeData.length; i++) {
            nodes.push({id: i, label: treeData[i]});
        }

        var edges = [];
        for (var i = 1; i < treeData.length; i++) {
            edges.push({from: Math.floor((i - 1) / 2), to: i});
        }

        var container = document.getElementById('network');
        var data = {
            nodes: new vis.DataSet(nodes),
            edges: new vis.DataSet(edges)
        };
        var options = {};
        var network = new vis.Network(container, data, options);
    }

    // Initial tree visualization
    updateTree();

    // Submit form using AJAX to prevent page reload
    document.getElementById('treeForm').addEventListener('submit', function(event) {
        event.preventDefault();
        var form = event.target;
        var formData = new FormData(form);

        // AJAX request to update the tree traversal and visualization
        fetch(form.action, {
            method: form.method,
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('treeTraversal').innerText = data.tree_traversal;
            updateTree();
        })
        .catch(error => console.error('Error:', error));
    });
</script>

</body>
</html>
